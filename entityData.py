COUNT = 0xFB
NAME = [
    "ARROW",
    "BOOMERANG",
    "BOMB",
    "HOOKSHOT_CHAIN",
    "HOOKSHOT_HIT",
    "LIFTABLE_ROCK",
    "PUSHED_BLOCK",
    "CHEST_WITH_ITEM",
    "MAGIC_POWDER_SPRINKLE",
    "OCTOROCK",
    "OCTOROCK_ROCK",
    "MOBLIN",
    "MOBLIN_ARROW",
    "TEKTITE",
    "LEEVER",
    "ARMOS_STATUE",
    "HIDING_GHINI",
    "GIANT_GHINI",
    "GHINI",
    "BROKEN_HEART_CONTAINER",
    "MOBLIN_SWORD",
    "ANTI_FAIRY",
    "SPARK_COUNTER_CLOCKWISE",
    "SPARK_CLOCKWISE",
    "POLS_VOICE",
    "KEESE",
    "STALFOS_AGGRESSIVE",
    "GEL",
    "MINI_GEL",
    "DISABLED",
    "STALFOS_EVASIVE",
    "GIBDO",
    "HARDHAT_BEETLE",
    "WIZROBE",
    "WIZROBE_PROJECTILE",
    "LIKE_LIKE",
    "IRON_MASK",
    "SMALL_EXPLOSION_ENEMY",
    "SMALL_EXPLOSION_ENEMY_2",
    "SPIKE_TRAP",
    "MIMIC",
    "MINI_MOLDORM",
    "LASER",
    "LASER_BEAM",
    "SPIKED_BEETLE",
    "DROPPABLE_HEART",
    "DROPPABLE_RUPEE",
    "DROPPABLE_FAIRY",
    "KEY_DROP_POINT",
    "SWORD",
    "32",
    "PIECE_OF_POWER",
    "GUARDIAN_ACORN",
    "HEART_PIECE",
    "HEART_CONTAINER",
    "DROPPABLE_ARROWS",
    "DROPPABLE_BOMBS",
    "INSTRUMENT_OF_THE_SIRENS",
    "SLEEPY_TOADSTOOL",
    "DROPPABLE_MAGIC_POWDER",
    "HIDING_SLIME_KEY",
    "DROPPABLE_SECRET_SEASHELL",
    "MARIN",
    "RACOON",
    "WITCH",
    "OWL_EVENT",
    "OWL_STATUE",
    "SEASHELL_MANSION_TREES",
    "YARNA_TALKING_BONES",
    "BOULDERS",
    "MOVING_BLOCK_LEFT_TOP",
    "MOVING_BLOCK_LEFT_BOTTOM",
    "MOVING_BLOCK_BOTTOM_LEFT",
    "MOVING_BLOCK_BOTTOM_RIGHT",
    "COLOR_DUNGEON_BOOK",
    "POT",
    "DISABLED",
    "SHOP_OWNER",
    "4D",
    "TRENDY_GAME_OWNER",
    "BOO_BUDDY",
    "KNIGHT",
    "TRACTOR_DEVICE",
    "TRACTOR_DEVICE_REVERSE",
    "FISHERMAN_FISHING_GAME",
    "BOUNCING_BOMBITE",
    "TIMER_BOMBITE",
    "PAIRODD",
    "PAIRODD_PROJECTILE",
    "MOLDORM",
    "FACADE",
    "SLIME_EYE",
    "GENIE",
    "SLIME_EEL",
    "GHOMA",
    "MASTER_STALFOS",
    "DODONGO_SNAKE",
    "WARP",
    "HOT_HEAD",
    "EVIL_EAGLE",
    "SOUTH_FACE_SHRINE_DOOR",
    "ANGLER_FISH",
    "CRYSTAL_SWITCH",
    "67",
    "68",
    "MOVING_BLOCK_MOVER",
    "RAFT_RAFT_OWNER",
    "TEXT_DEBUGGER",
    "CUCCO",
    "BOW_WOW",
    "BUTTERFLY",
    "DOG",
    "KID_70",
    "KID_71",
    "KID_72",
    "KID_73",
    "PAPAHLS_WIFE",
    "GRANDMA_ULRIRA",
    "MR_WRITE",
    "GRANDPA_ULRIRA",
    "YIP_YIP",
    "MADAM_MEOWMEOW",
    "CROW",
    "CRAZY_TRACY",
    "GIANT_GOPONGA_FLOWER",
    "GOPONGA_FLOWER_PROJECTILE",
    "GOPONGA_FLOWER",
    "TURTLE_ROCK_HEAD",
    "TELEPHONE",
    "ROLLING_BONES",
    "ROLLING_BONES_BAR",
    "DREAM_SHRINE_BED",
    "BIG_FAIRY",
    "MR_WRITES_BIRD",
    "FLOATING_ITEM",
    "DESERT_LANMOLA",
    "ARMOS_KNIGHT",
    "HINOX",
    "TILE_GLINT_SHOWN",
    "TILE_GLINT_HIDDEN",
    "8C",
    "8D",
    "CUE_BALL",
    "MASKED_MIMIC_GORIYA",
    "THREE_OF_A_KIND",
    "ANTI_KIRBY",
    "SMASHER",
    "MAD_BOMBER",
    "KANALET_BOMBABLE_WALL",
    "RICHARD",
    "RICHARD_FROG",
    "DIVE_SPOT",
    "HORSE_PIECE",
    "WATER_TEKTITE",
    "FLYING_TILES",
    "HIDING_GEL",
    "STAR",
    "LIFTABLE_STATUE",
    "FIREBALL_SHOOTER",
    "GOOMBA",
    "PEAHAT",
    "SNAKE",
    "PIRANHA_PLANT",
    "SIDE_VIEW_PLATFORM_HORIZONTAL",
    "SIDE_VIEW_PLATFORM_VERTICAL",
    "SIDE_VIEW_PLATFORM",
    "SIDE_VIEW_WEIGHTS",
    "SMASHABLE_PILLAR",
    "WRECKING_BALL",
    "BLOOPER",
    "CHEEP_CHEEP_HORIZONTAL",
    "CHEEP_CHEEP_VERTICAL",
    "CHEEP_CHEEP_JUMPING",
    "KIKI_THE_MONKEY",
    "WINGED_OCTOROK",
    "TRADING_ITEM",
    "PINCER",
    "HOLE_FILLER",
    "BEETLE_SPAWNER",
    "HONEYCOMB",
    "TARIN",
    "BEAR",
    "PAPAHL",
    "MERMAID",
    "FISHERMAN_UNDER_BRIDGE",
    "BUZZ_BLOB",
    "BOMBER",
    "BUSH_CRAWLER",
    "GRIM_CREEPER",
    "VIRE",
    "BLAINO",
    "ZOMBIE",
    "MAZE_SIGNPOST",
    "MARIN_AT_THE_SHORE",
    "MARIN_AT_TAL_TAL_HEIGHTS",
    "MAMU_AND_FROGS",
    "WALRUS",
    "URCHIN",
    "SAND_CRAB",
    "MANBO_AND_FISHES",
    "BUNNY_CALLING_MARIN",
    "MUSICAL_NOTE",
    "MAD_BATTER",
    "ZORA",
    "FISH",
    "BANANAS_SCHULE_SALE",
    "MERMAID_STATUE",
    "SEASHELL_MANSION",
    "ANIMAL_D0",
    "ANIMAL_D1",
    "ANIMAL_D2",
    "BUNNY_D3",
    "GHOST",
    "ROOSTER",
    "SIDE_VIEW_POT",
    "THWIMP",
    "THWOMP",
    "THWOMP_RAMMABLE",
    "PODOBOO",
    "GIANT_BUBBLE",
    "FLYING_ROOSTER_EVENTS",
    "BOOK",
    "EGG_SONG_EVENT",
    "SWORD_BEAM",
    "MONKEY",
    "WITCH_RAT",
    "FLAME_SHOOTER",
    "POKEY",
    "MOBLIN_KING",
    "FLOATING_ITEM_2",
    "FINAL_NIGHTMARE",
    "KANALET_CASTLE_GATE_SWITCH",
    "ENDING_OWL_STAIR_CLIMBING",
    "COLOR_SHELL_RED",
    "COLOR_SHELL_GREEN",
    "COLOR_SHELL_BLUE",
    "COLOR_GHOUL_RED",
    "COLOR_GHOUL_GREEN",
    "COLOR_GHOUL_BLUE",
    "ROTOSWITCH_RED",
    "ROTOSWITCH_YELLOW",
    "ROTOSWITCH_BLUE",
    "FLYING_HOPPER_BOMBS",
    "HOPPER",
    "AVALAUNCH",
    "BOUNCING_BOULDER",
    "COLOR_GUARDIAN_BLUE",
    "COLOR_GUARDIAN_RED",
    "GIANT_BUZZ_BLOB",
    "HARDHIT_BEETLE",
    "PHOTOGRAPHER",
]
# For each entity, which sprite slot is used and which value should be used.
SPRITE_DATA = {
    0x09: (2, 0xE3), # OCTOROCK
    0x0B: (2, 0x92), # MOBLIN
    0x0D: (1, 0x87), # TEKTITE
    0x0E: (1, 0x81), # LEEVER
    0x0F: (2, 0x78), # ARMOS_STATUE
    0x10: (1, 0x42), # HIDING_GHINI
    0x11: (2, 0x8A), # GIANT_GHINI
    0x12: (1, 0x42), # GHINI
    0x14: (2, 0x92), # MOBLIN_SWORD
    0x15: (1, 0x91), # ANTI_FAIRY
    0x16: (1, 0x91), # SPARK_COUNTER_CLOCKWISE (or (1, 0x65))
    0x17: (1, 0x91), # SPARK_CLOCKWISE (or (1, 0x65))
    0x18: (3, 0x93), # POLS_VOICE
    0x19: (0, 0x90), # KEESE
    0x1A: (0, 0x90), # STALFOS_AGGRESSIVE
    0x1B: None,      # GEL
    0x1C: (1, 0x91), # MINI_GEL
    0x1E: (0, 0x90), # STALFOS_EVASIVE
    0x1F: (3, 0x93), # GIBDO
    0x20: (0, 0x90), # HARDHAT_BEETLE
    0x21: (2, 0x95), # WIZROBE
    0x23: (3, 0x93), # LIKE_LIKE
    0x24: (2, 0x94), # IRON_MASK and (3, 0x9f)
    0x27: (1, 0x91), # SPIKE_TRAP
    0x28: (2, 0x96), # MIMIC
    0x29: (3, 0x98), # MINI_MOLDORM
    0x2A: (3, 0x99), # LASER
    0x2C: (3, 0x60), # SPIKED_BEETLE (or 0x9b?)
    0x2D: None,      # DROPPABLE_HEART
    0x2E: None,      # DROPPABLE_RUPEE
    0x2F: None,      # DROPPABLE_FAIRY
    0x30: None,      # KEY_DROP_POINT
    0x31: None,      # SWORD
    0x35: None,      # HEART_PIECE
    0x37: None,      # DROPPABLE_ARROWS
    0x38: None,      # DROPPABLE_BOMBS
    0x39: None,      # INSTRUMENT_OF_THE_SIRENS
    0x3A: (1, 0x8e), # SLEEPY_TOADSTOOL
    0x3B: None,      # DROPPABLE_MAGIC_POWDER
    0x3C: None,      # HIDING_SLIME_KEY
    0x3D: None,      # DROPPABLE_SECRET_SEASHELL
    0x3E: (2, 0xe6), # MARIN
    0x3F: (1, 0x6c), # RACOON  ((1, 0x6c) indoors and (1, 0x6c) + (3, 0xc8) in the woods)
    0x40: (2, 0xa3), # WITCH
    0x41: None,      # OWL_EVENT
    0x42: (1, 0x91), # OWL_STATUE
    0x43: None,      # SEASHELL_MANSION_TREES
    0x44: None,      # YARNA_TALKING_BONES
    0x45: (1, 0x44), # BOULDERS
    0x46: None,      # MOVING_BLOCK_LEFT_TOP
    0x47: None,      # MOVING_BLOCK_LEFT_BOTTOM
    0x48: None,      # MOVING_BLOCK_BOTTOM_LEFT
    0x49: None,      # MOVING_BLOCK_BOTTOM_RIGHT
    0x4A: (1, 0xd5), # COLOR_DUNGEON_BOOK
    0x4D: (2, 0x88), # SHOP_OWNER and (3, 0xc7)
    0x4F: (2, 0x84), # TRENDY_GAME_OWNER and (3, 0x89)
    0x50: (2, 0x97), # BOO_BUDDY
    0x51: (2, 0x92), # KNIGHT
    0x52: (0, 0x7b), # TRACTOR_DEVICE or (0, 0xa6)
    0x53: (0, 0x7b), # TRACTOR_DEVICE_REVERSE or (0, 0xa6)
    0x54: (3, 0x4e), # FISHERMAN_FISHING_GAME
    0x61: None,      # WARP
    0x6A: (1, 0x87), # RAFT_RAFT_OWNER
    0x6C: None,      # CUCCU
    0x6D: None,      # BOW_WOW (TODO, BowWow can use sprites from 2nd VRAM bank)
    0x6E: (1, 0xE5), # BUTTERFLY
    0x6F: (1, 0xE5), # DOG
    0x70: (3, 0xE7), # KID_70
    0x71: (3, 0xE7), # KID_71
    0x72: (3, 0xE7), # KID_72
    0x73: (3, 0xE7), # KID_73
    0x75: (2, 0x43), # GRANDMA_ULRIRA
    0x7A: (1, 0xC6), # CROW
    0x7C: (1, 0x40), # GIANT_GOPONGA_FLOWER
    0x7E: (1, 0x4A), # GOPONGA_FLOWER
    0x7F: (3, 0x41), # TURTLE_ROCK_HEAD
    0x84: (1, 0x4D), # BIG_FAIRY
    0x86: None,      # FLOATING_ITEM
    0x87: (3, 0x52), # DESERT_LANMOLA
    0x93: (3, 0x5A), # MAD_BOMBER
    0x97: None,      # DIVE_SPOT
    0x9B: None,      # HIDING_GEL
    0xAD: (3, 0x67), # KIKI_THE_MONKEY
    0xAE: (1, 0xE3), # WINGED_OCTOROCK
    0xAF: None,      # TRADING_ITEM
    0xB0: (2, 0x8B), # PINCER
    0xB2: (2, 0x8C), # BEETLE_SPAWNER
    0xB3: (3, 0x6B), # HONEYCOMB
    0xB4: (1, 0x6C), # TARIN
    0xB6: (3, 0x6D), # PAPAHL
    0xB7: (3, 0x71), # MERMAID
    0xB9: (2, 0x79), # BUZZ_BLOB
    0xBA: (3, 0x76), # BOMBER
    0xBB: (3, 0x76), # BUSH_CRAWLER
    0xBF: (2, 0x82), # ZOMBIE
    0xC0: None,      # MAZE_SIGNPOST
    0xC1: (2, 0x8F), # MARIN_AT_THE_SHORE (could be something missing here)
    0xC2: (2, 0x8F), # MARIN_AT_TAL_TAL_HEIGHTS
    0xC4: (2, 0x6E), # WALRUS (and (3, 0x6F))
    0xC5: (1, 0x81), # URCHIN
    0xC6: (1, 0x81), # SAND_CRAB
    0xCB: (1, 0x61), # ZORA
    0xCC: (1, 0x4A), # FISH
    0xCD: (3, 0xD4), # BANANAS_SCHULE_SALE
    0xCE: (3, 0x73), # MERMAID_STATUE
    0xD0: (1, 0xC4), # ANIMAL_D0
    0xD1: (3, 0xCF), # ANIMAL_D1
    0xD2: (3, 0xCF), # ANIMAL_D2
    0xD3: (1, 0xC4), # BUNNY_D3
    0xDC: None,      # FLYING_ROOSTER_EVENTS
    0xDE: None,      # EGG_SONG_EVENT (TODO: Instrument sprites from 2nd vram bank)
    0xE0: (3, 0xD4), # MONKEY
    0xE3: (3, 0x8C), # POKEY
    0xE5: None,      # FLOATING_ITEM_2
    0xFA: None,      # PHOTOGRAPHER
}

assert len(NAME) == COUNT


class Entity:
    def __init__(self, index):
        self.index = index
        self.group = None
        self.physics_flags = None
        self.bowwow_eat_flag = None


class Group:
    def __init__(self, index):
        self.index = index
        self.health = None
        self.link_damage = None


class EntityData:
    def __init__(self, rom):
        groups = rom.banks[0x03][0x01F6:0x01F6+COUNT]
        group_count = max(groups) + 1
        group_damage_type = rom.banks[0x03][0x03EC:0x03EC+group_count*16]
        damage_per_damage_type = rom.banks[0x03][0x073C:0x073C+8*16]

        self.entities = []
        self.groups = []
        for n in range(group_count):
            g = Group(n)
            g.health = rom.banks[0x03][0x07BC+n]
            g.link_damage = rom.banks[0x03][0x07F1+n]
            self.groups.append(g)
        for n in range(COUNT):
            e = Entity(n)
            e.group = self.groups[groups[n]]
            e.physics_flags = rom.banks[0x03][0x0000 + n]
            e.bowwow_eat_flag = rom.banks[0x14][0x1218+n]
            self.entities.append(e)

        #print(sum(bowwow_eatable))
        #for n in range(COUNT):
        #    if bowwow_eatable[n]:
        #        print(hex(n), NAME[n])
        for n in range(group_count):
            entities = list(map(lambda data: NAME[data[0]], filter(lambda data: data[1] == n, enumerate(groups))))
            #print(hex(n), damage_to_link[n], entities)
            dmg = bytearray()
            for m in range(16):
                dmg.append(damage_per_damage_type[m*8+group_damage_type[n*16+m]])
            import binascii
            #print(binascii.hexlify(group_damage_type[n*16:n*16+16]))
            #print(binascii.hexlify(dmg))


if __name__ == "__main__":
    from rom import ROM
    import sys
    rom = ROM(sys.argv[1])
    ed = EntityData(rom)
    for e in ed.entities:
        print(NAME[e.index], e.bowwow_eat_flag)
